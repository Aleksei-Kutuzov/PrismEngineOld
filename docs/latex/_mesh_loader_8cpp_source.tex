\doxysection{Mesh\+Loader.\+cpp}
\hypertarget{_mesh_loader_8cpp_source}{}\label{_mesh_loader_8cpp_source}\index{C:/Users/Admin/Desktop/PrismEngine/PrismEngine/src/PRISM\_objects3D/MeshLoader.cpp@{C:/Users/Admin/Desktop/PrismEngine/PrismEngine/src/PRISM\_objects3D/MeshLoader.cpp}}
\mbox{\hyperlink{_mesh_loader_8cpp}{См. документацию.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_mesh_loader_8h}{MeshLoader.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{other_8h}{../PRISM\_math/other.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00005}\mbox{\hyperlink{class_mesh_loader_aa69666419dbf06517d48bc6250f17916}{00005}}\ \mbox{\hyperlink{struct_p_r_i_s_m___mesh}{PRISM\_Mesh}}\ \mbox{\hyperlink{class_mesh_loader_aa69666419dbf06517d48bc6250f17916}{MeshLoader::LoadOBJ}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ filename,\ \mbox{\hyperlink{class_abstract_camera3_d}{AbstractCamera3D}}\ camera)\ \{}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00006}00006\ \ \ \ \ SDL\_RWops*\ file\ =\ SDL\_RWFromFile(filename,\ \textcolor{stringliteral}{"{}r"{}});}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00007}00007\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00008}00008\ \ \ \ \ \mbox{\hyperlink{struct_p_r_i_s_m___mesh}{PRISM\_Mesh}}\ mesh\ =\ \{\};}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00010}00010\ \ \ \ \ \textcolor{keywordflow}{if}\ (!file)\ \{}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00011}00011\ \ \ \ \ \ \ \ \ SDL\_Log(\textcolor{stringliteral}{"{}Could\ not\ open\ file:\ \%s"{}},\ SDL\_GetError());}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00012}00012\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ mesh;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00013}00013\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00015}00015\ \ \ \ \ Sint64\ fileSize\ =\ SDL\_RWsize(file);}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00016}00016\ \ \ \ \ \textcolor{keywordtype}{char}*\ buffer\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{char}[fileSize\ +\ 1];}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00017}00017\ \ \ \ \ SDL\_RWread(file,\ buffer,\ fileSize,\ 1);}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00018}00018\ \ \ \ \ buffer[fileSize]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00019}00019\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00020}00020\ \ \ \ \ std::string\ line;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00021}00021\ \ \ \ \ std::istringstream\ fileContent(buffer);}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00022}00022\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00023}00023\ \ \ \ \ std::vector<PRISM\_Vector3d>\ vertices;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00024}00024\ \ \ \ \ std::vector<PRISM\_Vector3d>\ normals;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00025}00025\ \ \ \ \ std::vector<PRISM\_Triangle>\ triangles;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00026}00026\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00028}00028\ \ \ \ \ mesh.\mbox{\hyperlink{struct_p_r_i_s_m___mesh_ac393379bc7f471ceca77be5b67626168}{tris}}\ =\ \{\};}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00029}00029\ \ \ \ \ \textcolor{keywordflow}{while}\ (getline(fileContent,\ line))\ \{}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00030}00030\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line.empty()\ ||\ line[0]\ ==\ \textcolor{charliteral}{'\#'})\ \{}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00031}00031\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};\ \textcolor{comment}{//\ Пропускаем\ пустые\ строки\ и\ комментарии}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00032}00032\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00033}00033\ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00034}00034\ \ \ \ \ \ \ \ \ std::istringstream\ iss(line);}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00035}00035\ \ \ \ \ \ \ \ \ std::string\ identifier;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00036}00036\ \ \ \ \ \ \ \ \ iss\ >>\ identifier;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00038}00038\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (identifier\ ==\ \textcolor{stringliteral}{"{}v"{}})\ \{}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00039}00039\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Вершина}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00040}00040\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_p_r_i_s_m___vector3d}{PRISM\_Vector3d}}\ v;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00041}00041\ \ \ \ \ \ \ \ \ \ \ \ \ iss\ >>\ v.\mbox{\hyperlink{struct_p_r_i_s_m___vector3d_ad0da36b2558901e21e7a30f6c227a45e}{x}}\ >>\ v.\mbox{\hyperlink{struct_p_r_i_s_m___vector3d_aa4f0d3eebc3c443f9be81bf48561a217}{y}}\ >>\ v.\mbox{\hyperlink{struct_p_r_i_s_m___vector3d_af73583b1e980b0aa03f9884812e9fd4d}{z}};}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00042}00042\ \ \ \ \ \ \ \ \ \ \ \ \ vertices.push\_back(v);}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00043}00043\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00044}00044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (identifier\ ==\ \textcolor{stringliteral}{"{}vn"{}})\ \{}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00045}00045\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Нормаль}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00046}00046\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_p_r_i_s_m___vector3d}{PRISM\_Vector3d}}\ n;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00047}00047\ \ \ \ \ \ \ \ \ \ \ \ \ iss\ >>\ n.\mbox{\hyperlink{struct_p_r_i_s_m___vector3d_ad0da36b2558901e21e7a30f6c227a45e}{x}}\ >>\ n.\mbox{\hyperlink{struct_p_r_i_s_m___vector3d_aa4f0d3eebc3c443f9be81bf48561a217}{y}}\ >>\ n.\mbox{\hyperlink{struct_p_r_i_s_m___vector3d_af73583b1e980b0aa03f9884812e9fd4d}{z}};}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00048}00048\ \ \ \ \ \ \ \ \ \ \ \ \ normals.push\_back(n);}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00049}00049\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00050}00050\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (identifier\ ==\ \textcolor{stringliteral}{"{}f"{}})\ \{}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Грань}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<int>\ vertexIndices;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<int>\ normalIndices;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ facePart;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (iss\ >>\ facePart)\ \{}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Разбиваем\ каждую\ часть\ грани\ (например,\ "{}1//1"{}\ или\ "{}1/1/1"{})}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ firstSlash\ =\ facePart.find(\textcolor{charliteral}{'/'});}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00059}00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ secondSlash\ =\ facePart.find(\textcolor{charliteral}{'/'},\ firstSlash\ +\ 1);}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Извлекаем\ индекс\ вершины\ (до\ первого\ '/')}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ vertexIndex\ =\ std::stoi(facePart.substr(0,\ firstSlash))\ -\/\ 1;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00063}00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vertexIndices.push\_back(vertexIndex);}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00064}00064\ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00065}00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Проверяем,\ есть\ ли\ индекс\ нормали\ (после\ второго\ '/')}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00066}00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (secondSlash\ !=\ std::string::npos)\ \{}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ normalIndex\ =\ std::stoi(facePart.substr(secondSlash\ +\ 1))\ -\/\ 1;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normalIndices.push\_back(normalIndex);}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00069}00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Создаем\ треугольник,\ если\ индексы\ вершин\ определены}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00072}00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertexIndices.size()\ ==\ 3)\ \{}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_p_r_i_s_m___triangle}{PRISM\_Triangle}}\ tri\ =\ \{}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vertices[vertexIndices[0]],}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vertices[vertexIndices[1]],}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vertices[vertexIndices[2]]}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Если\ указаны\ нормали,\ добавляем\ их\ в\ треугольник}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!normalIndices.empty()\ \&\&\ normalIndices.size()\ ==\ 3)\ \{}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tri.\mbox{\hyperlink{struct_p_r_i_s_m___triangle_a1d4a7b3b2f67d1c45e08010317b4b4bc}{a\_norlmal}}\ =\ normals[normalIndices[0]];}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tri.\mbox{\hyperlink{struct_p_r_i_s_m___triangle_a41b34676271f1d1f9e7a457d301cf75c}{b\_norlmal}}\ =\ normals[normalIndices[1]];}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tri.\mbox{\hyperlink{struct_p_r_i_s_m___triangle_aea1c66594ed2f5bb0423abbcb8fc003e}{c\_norlmal}}\ =\ normals[normalIndices[2]];}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Добавляем\ треугольник\ в\ объект}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mesh.\mbox{\hyperlink{struct_p_r_i_s_m___mesh_ac393379bc7f471ceca77be5b67626168}{tris}}.push\_back(tri);}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00087}00087\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00088}00088\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00089}00089\ \ \ \ \ \textcolor{keyword}{delete}[]\ buffer;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00090}00090\ \ \ \ \ SDL\_RWclose(file);}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00091}00091\ }
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00092}00092\ \ \ \ \ \textcolor{keywordflow}{return}\ mesh;}
\DoxyCodeLine{\Hypertarget{_mesh_loader_8cpp_source_l00093}00093\ \};}

\end{DoxyCode}
